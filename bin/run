#!/bin/bash

RED='\033[0;31m'
GREEN='\033[0;32m'
NC='\033[0m'

{
    rm ./out.asm
    rm ./out.o
    rm ./out
} 2> /dev/null

# compile, link and assemble the program
export RUST_BACKTRACE=1
bin/compile_std
cargo run -- "$@"

if test -f "./out.asm"; then
  nasm -f elf64 out.asm

  if test -f "./out.o"; then
    ld -s -o out out.o std.o
  fi
fi

if test -f "./out"; then
    ./out
else
    printf "${RED}No output file!${NC}\n"
fi
