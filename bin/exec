#!/bin/bash

GREEN='\033[0;32m'
NC='\033[0m'

{
    rm ./out.asm
    rm ./out.o
    rm ./out
} 2> /dev/null

errors=$({
  # compile, link and assemble the program
  export RUST_BACKTRACE=1
  bin/compiler_std
  cargo run -- --std std.asm -e "$@"
})

output="BASH_ERROR_NOT_ASSIGNED"
if test -f "./out"; then
    # remove any \0 characters from output
    # stops 'warning: command substitution: ignored null byte in input'
    output=$(./out | tr -d '\000')
else
    output="ERROR_NO_OUTPUT"
fi

if [ "$errors" != "" ]; then
    printf "%s'\n\n" "$errors"
fi

printf "${GREEN}Program output:${NC}\n"
echo "$output"
